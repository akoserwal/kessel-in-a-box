# Kessel-in-a-Box Environment Configuration
# Copy this file to .env and customize as needed

# ============================================================================
# SpiceDB Configuration
# ============================================================================

# Pre-shared key for authentication (minimum 16 characters)
# Used for gRPC authentication between clients and SpiceDB
SPICEDB_PRESHARED_KEY=testtesttesttest

# Port mappings
SPICEDB_GRPC_PORT=50051
SPICEDB_HTTP_PORT=8443
SPICEDB_METRICS_PORT=9090

# Logging level: debug, info, warn, error
SPICEDB_LOG_LEVEL=info

# ============================================================================
# PostgreSQL Configuration (3 separate instances)
# ============================================================================

# Shared password for all PostgreSQL instances
POSTGRES_PASSWORD=secretpassword

# PostgreSQL RBAC - insights-rbac database
POSTGRES_RBAC_PORT=5432
POSTGRES_RBAC_USER=rbac
POSTGRES_RBAC_DB=rbac

# PostgreSQL Inventory - insights-host-inventory + kessel-inventory databases
POSTGRES_INVENTORY_PORT=5433
POSTGRES_INVENTORY_USER=inventory
POSTGRES_INVENTORY_DB=inventory

# PostgreSQL SpiceDB - SpiceDB authorization engine
POSTGRES_SPICEDB_PORT=5434
POSTGRES_SPICEDB_USER=spicedb
POSTGRES_SPICEDB_DB=spicedb

# Database tuning (advanced)
# POSTGRES_MAX_CONNECTIONS=100
# POSTGRES_SHARED_BUFFERS=256MB
# POSTGRES_EFFECTIVE_CACHE_SIZE=1GB

# ============================================================================
# Kafka Configuration (Phase 2 - Optional)
# ============================================================================

# Kafka ports
KAFKA_PORT=9092           # External port
KAFKA_JMX_PORT=9101       # JMX monitoring

# Topic configuration
KAFKA_PARTITIONS=3
KAFKA_REPLICATION_FACTOR=1

# Zookeeper
ZOOKEEPER_PORT=2181

# Kafka Connect (Debezium)
KAFKA_CONNECT_PORT=8085   # Changed from 8083 (conflicts with inventory-api)

# Schema Registry (optional)
SCHEMA_REGISTRY_PORT=8081

# Kafka UI (optional)
KAFKA_UI_PORT=8086        # Changed from 8080 (conflicts with insights-rbac)

# ============================================================================
# Redis Configuration (NOT used in Kessel - removed to match production)
# ============================================================================
# Note: Production Kessel does not use Redis for caching
# Kept here for reference only - not deployed in kessel-in-a-box

# Redis server
# REDIS_PORT=6379
# REDIS_PASSWORD=redispassword
# REDIS_MAX_MEMORY=256mb

# Redis Commander (Web UI)
# REDIS_COMMANDER_PORT=8081
# REDIS_COMMANDER_USER=admin
# REDIS_COMMANDER_PASSWORD=admin

# Redis Exporter (Prometheus metrics)
# REDIS_EXPORTER_PORT=9121

# Cache TTL settings (seconds)
# CACHE_TTL=60                    # Permission checks
# CACHE_TTL_SCHEMA=300            # Schema definitions (5 min)
# CACHE_TTL_RELATIONSHIPS=30      # Relationship lookups

# ============================================================================
# Monitoring Configuration (Phase 4 - Optional)
# ============================================================================

# Prometheus
PROMETHEUS_PORT=9091
PROMETHEUS_RETENTION=15d

# Grafana
GRAFANA_PORT=3000
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin

# AlertManager
ALERTMANAGER_PORT=9093

# Node Exporter
NODE_EXPORTER_PORT=9100

# ============================================================================
# Jaeger Configuration (Phase 4 - Optional)
# ============================================================================

# Jaeger UI
JAEGER_UI_PORT=16686

# Jaeger Collector
JAEGER_COLLECTOR_HTTP_PORT=14268
JAEGER_COLLECTOR_GRPC_PORT=14250

# OTLP (OpenTelemetry Protocol)
JAEGER_OTLP_GRPC_PORT=4317
JAEGER_OTLP_HTTP_PORT=4318

# ============================================================================
# Kessel Services Configuration (Phase 5)
# ============================================================================

# Kessel Relations API - SpiceDB frontend (ONLY service talking to SpiceDB)
KESSEL_RELATIONS_PORT=8082
KESSEL_RELATIONS_METRICS_PORT=9001
KESSEL_RELATIONS_LOG_LEVEL=info

# Kessel Inventory API - Resource management + authorization proxy
KESSEL_INVENTORY_PORT=8083
KESSEL_INVENTORY_METRICS_PORT=9002
KESSEL_INVENTORY_LOG_LEVEL=info

# OIDC Authentication (optional - leave empty for development)
OIDC_ISSUER_URL=
OIDC_CLIENT_ID=

# OpenTelemetry (optional - leave empty to disable)
OTEL_ENDPOINT=

# ============================================================================
# Insights Services Configuration (Phase 6 - Optional)
# ============================================================================

# Insights RBAC Service
INSIGHTS_RBAC_PORT=8080

# Insights Host Inventory Service
INSIGHTS_INVENTORY_PORT=8081

# Principal Proxy (Mock service for development)
PRINCIPAL_PROXY_PORT=8090

# Kessel Integration
KESSEL_ENABLED=true
KESSEL_INSECURE=true

# ============================================================================
# Local Development Mode
# ============================================================================
# Skip deploying specific services to run them locally from source.
# Other Docker services will route to your local process via host-gateway.
#
# SKIP_RELATIONS_API=true            # Run kessel-relations-api locally (port 8000)
# SKIP_INVENTORY_API=true            # Run kessel-inventory-api locally (port 8000)
# SKIP_INSIGHTS_RBAC=true            # Run insights-rbac locally (port 8080)
# SKIP_INSIGHTS_HOST_INVENTORY=true  # Run insights-host-inventory locally (port 8081)

# ============================================================================
# Development Settings
# ============================================================================

# Enable debug mode (more verbose logging)
# DEBUG=true

# Auto-reload schemas on file change
# AUTO_RELOAD_SCHEMAS=true

# Sample data to load on startup
# LOAD_SAMPLE_DATA=github,gdrive,healthcare
